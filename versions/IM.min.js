(function(c){var p=false,q=null,o=false,b=0,a=[],h=i;function l(s,u,w){var v=s.concat();var r=s.length-1;var x=+new Date();setTimeout(function t(){do{r--;if(u(v.shift(),r)===false){return}}while(v.length>0&&(+new Date()-x<50));if(v.length>0){setTimeout(t,25)}else{w(s)}},25)}function i(s,t,v){var u=s.concat();var r=s.length-1;var w=null;while(Boolean(w=u.shift())){r--;if(t(w,r)===false){return}}v(s)}function d(r,t,x,v){var u=null,s=null,w=undefined;if(p&&typeof v==="undefined"){v=+new Date()}h(r,function(C,y){var B=C.getContext("2d"),A=B.getImageData(0,0,C.width,C.height),z=JSON.stringify([].slice.call(A.data));if(u!==null){if(u.localeCompare(z)!==0){if(q){n(q,C.width,C.height,A,s)}if(p){C.className="fail";w=(+new Date()-v);console.log("Fail -> Time: "+w);console.log("Failing  canvas is: ");console.log(document.getElementById("canvasCompare_"+y))}x(C,w);return false}}s=A;u=z},function(y){if(p){w=(+new Date()-v);console.log("Success -> Time: "+w)}t(y,w)})}function n(r,w,K,A,F){var t=A.data,H=F.data,y=document.createElement("canvas"),B=y.getContext("2d"),J=B.createImageData(w,K),D=J.data,z,I,E,C,x,u,v,s;y.width=w;y.height=K;r.appendChild(y);for(var G=0;G<t.length;G+=4){z=t[G+0];I=t[G+1];E=t[G+2];C=t[G+3];x=H[G];u=H[G+1];v=H[G+2];s=H[G+3];if(z!==x){D[G+0]=z>x?z-x:u-z}else{D[G+0]=t[G+0]}if(I!==u){D[G+1]=I>u?I-u:u-I}else{D[G+1]=t[G+1]}if(E!==v){D[G+2]=E>v?E-v:v-E}else{D[G+2]=t[G+2]}if(C!==s){D[G+3]=C>u?s-s:s-C}else{D[G+3]=t[G+3]}}B.putImageData(J,0,0)}function j(t,w,s,v){a=[];if(p){var u=+new Date()}h(w,function(y,x){var B,A,z;B=document.createElement("canvas");B.id="canvasCompare_"+x;a.push(B);B.width=y.width;B.height=y.height;t.appendChild(B);A=B.getContext("2d");z=new Image();z.onload=function(){b++;A.drawImage(z,0,0)};z.onerror=function(){b++};z.src=y.src},function r(x){if(b<x.length){setTimeout(function(){r(x)},25)}else{d(a,s,v,u);if(p&&o){console.log("After compare -> Time: "+(+new Date()-u))}}})}var g=function(t,s,r){this.src=t+(t.indexOf("?")===-1?"?":"&")+(+new Date());this.width=s;this.height=r};function e(){}e.prototype.setDebug=function k(r){p=r;return p};e.prototype.setAsynchronous=function m(r){o=r;h=o?l:i;return r};e.prototype.setDiff=function f(r){q=r;return q};e.prototype.compare=function(s,u,r,t){if(!s.nodeType){d.apply(this,arguments)}else{j.apply(this,arguments)}};e.prototype.image=g;c.IM=new e()}(window));